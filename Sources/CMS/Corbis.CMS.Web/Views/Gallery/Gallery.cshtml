@using System.Drawing
@using Corbis.CMS.Web.Models
@model GalleryModel
@{
    ViewBag.Title = "Edit Gallery";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
    var culture = System.Threading.Thread.CurrentThread.CurrentCulture;
}

@Html.Hidden("GalleryID", this.Model.ID.Value);
<h2>Edit Gallery</h2>

<style type="text/css" media="screen">
    object:focus
    {
        outline: none;
    }
    #flashContent
    {
        display: none;
    }
</style>

@Scripts.Render("~/Scripts/Corbis/Uploader.js")
@Scripts.Render("~/Scripts/Corbis/Corbis.Gallery.js")

<script type="text/javascript">
    GalleryPageMngr.galleryID = @(this.Model.ID.Value);
    GalleryPageMngr.deleteContentImageURL = '@Url.Action("DeleteContentImage", "Gallery")';
    GalleryPageMngr.swapImageOrderURL = '@Url.Action("SwapImageOrder", "Gallery")';
    GalleryPageMngr.fontFamiliesURL = '@Url.Action("GetFontFamilies", "Gallery")';

    uploaderOptions.url = "/api/Upload/UploadGalleryImage?id=@this.Model.ID.Value";
    uploaderOptions.uploadCallBack = "uploadImageCallback";
    uploaderOptions.errorCallBack = "uploadImageErrorCallback";
    uploaderOptions.filter = "*.jpg;*.jpeg";

//    uploaderOptions.viewMode = "single";
//    uploaderOptions.size = { width: 330, height: 40 }

    function uploadImageCallback(result) {
        var onsuccess = function (data) {
            if (data.success === false) {
                alert(data.error);
                return;
            }
            $('div.galleryContent').append(data);
        }

        var data = jQuery.parseJSON(result);

        $.ajax({
            url: data.IsCover ? '@this.Url.Action("GetCoverImage", "Gallery")' : '@this.Url.Action("GetContentImage", "Gallery")',
            type: 'POST',
            data: data,
            success: onsuccess
        });

        return "OK";
    }
    function uploadImageErrorCallback(type, errorMessage) {
        alert("[errorCallBack] : " + type + " ::: " + errorMessage);
        return "OK";
    }
</script>
<div class="globalToolbar">
    <ul>
        <li>
            @Html.ActionLink("Build and Preview", "BuildGallery", "Gallery", new { id = this.Model.ID }, new { target = "_blank" })
        </li>
        <li>
            @Html.ActionLink("Download Gallery", "Download", "Gallery", new { id = this.Model.ID }, null)
        </li>
        <li>
            <a href="javascript:void(0)" onclick="ClearGalleryContent(@this.Model.ID, '@Url.Action("ClearGalleryContent", "Gallery")'); return false;">Clear content</a>
        </li>
        <li>
            <a href="javascript:void(0)" onclick="ExpandImagesAll(); return false;">Expand all</a>
        </li>
        <li>
            <a href="javascript:void(0)" onclick="CollapseImagesAll(); return false;">Collapse all</a>
        </li>

    </ul>
</div>

@using (Ajax.BeginForm("SaveGalleryAttributes", "Gallery", new { id = this.Model.ID }, new AjaxOptions() { OnBegin = "onBeginMsAjaxRequest", OnComplete = "onCompleteMsAjaxRequest", OnSuccess = "onSaveGalleryAttributes" }, new { id = "galleryAttributesForm" })) {
    @Html.ValidationSummary();
<div>     
    <table>
        <tbody>
            <tr>
                <td>Gallery Name</td>
                <td>@Html.TextBoxFor(x => x.Name)</td>
            </tr>
            <tr>
                <td>Font Family</td>
                <td>
                    <select name="fontFamily">
                    @{        
                        var ff = !string.IsNullOrEmpty(this.Model.FontFamily) ? FontFamily.Families.Where(x => x.Name == this.Model.FontFamily).SingleOrDefault() : null;
                    }
                    @if (ff != null)
                    {
                        <option value="@this.Model.FontFamily">@ff.GetName(culture.LCID)</option>
                    }
                    else
                    { 
                        <option>Select</option>
                    }
                    </select>                
                </td>
            </tr>
            <tr>
                <td>Transitions</td>
                <td>
                    <label for="transitionsOff">Off</label>@Html.RadioButtonFor(x => x.TransitionsIncluded, false, new { id = "transitionsOff" })
                    <label for="transitionsOn">On</label>@Html.RadioButtonFor(x => x.TransitionsIncluded, true, new { id = "transitionsOn" })
                </td>
            </tr>
        </tbody>
    </table>                        
    <input type="submit" value="Save" />
</div>
}
<div class="galleryContent">
    @if (this.Model.CoverImage != null) { 
        @Html.Partial("CoverImagePartial", this.Model.CoverImage)
    }
    @if (this.Model.ContentImages != null) {
        foreach (var image in this.Model.ContentImages) {
            @Html.Partial("ContentImagePartial", image);
        }
    }
</div>
<div id="flashContent">
    <p>
        To view this page ensure that Adobe Flash Player version 11.1.0 or greater is installed.
    </p>
    <script type="text/javascript">
        var pageHost = ((document.location.protocol == "https:") ? "https://" : "http://");
        document.write("<a href='http://www.adobe.com/go/getflashplayer'><img src='"
								+ pageHost + "www.adobe.com/images/shared/download_buttons/get_flash_player.gif' alt='Get Adobe Flash player' /></a>"); 
    </script>
</div>
<noscript>
    <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"
        id="SimpleUploader">
        <param name="movie" value="SimpleUploader.swf" />
        <param name="quality" value="high" />
        <param name="bgcolor" value="#ffffff" />
        <param name="allowScriptAccess" value="sameDomain" />
        <param name="allowFullScreen" value="true" />
        <!--[if !IE]>-->
        <object type="application/x-shockwave-flash" data="~SimpleUploader.swf"
            width="100%" height="100%">
            <param name="quality" value="high" />
            <param name="bgcolor" value="#ffffff" />
            <param name="allowScriptAccess" value="sameDomain" />
            <param name="allowFullScreen" value="true" />
            <!--<![endif]-->
            <!--[if gte IE 6]>-->
            <p>
                Either scripts and active content are not permitted to run or Adobe Flash Player
                version 11.1.0 or greater is not installed.
            </p>
            <!--<![endif]-->
            <a href="http://www.adobe.com/go/getflashplayer">
                <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"
                    alt="Get Adobe Flash Player" />
            </a>
            <!--[if !IE]>-->
        </object>
        <!--<![endif]-->
    </object>
</noscript>
